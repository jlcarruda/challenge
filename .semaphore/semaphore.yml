version: v1.0
name: First pipeline
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804
blocks:
  - name: Lint
    task:
      prologue:
        commands:
          - checkout
      jobs:
        - name: make lint
          commands:
            - npm install
            - node node_modules/gulp/bin/gulp lint
    dependencies: []
  - name: Unit tests
    task:
      prologue:
        commands:
          - checkout
          - npm install
      jobs:
        - name: npm install
          commands:
            - echo "TEST COMPLETED"
    dependencies:
      - Lint
  - name: Build
    dependencies:
      - Unit tests
    task:
      prologue:
        commands:
          - checkout
          - npm install
      jobs:
        - name: build
          commands:
            - node node_modules/gulp/bin/gulp build
  # - name: Deploy
  #   dependencies:
  #     - Build
  #   skip:
  #     when: branch != 'master'
  #   task:
  #     prologue:
  #       commands:
  #         - git fetch --all
  #         - git pull origin master
  #         - checkout
  #     jobs:
  #       - name: Deploy
  #         commands:
  #           - git push heroku $SEMAPHORE_GIT_BRANCH:master
promotions:
  - name: Deploy to heroku
    pipeline_file: heroku.yml
